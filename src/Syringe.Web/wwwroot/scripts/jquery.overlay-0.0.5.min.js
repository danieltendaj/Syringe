!function(t){"use strict";var e=void 0!==t("<div></div>").css(["color"]).color?function(t,e){return t.css(e)}:function(e,r){var a;return a={},t.each(r,function(t,r){a[r]=e.css(r)}),a},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},a=/[&<>"'\/]/g,i=function(t){return void 0!==t?t.replace(a,function(t){return r[t]}):void 0},s=function(){function r(r){var i,l;"static"===(l=r.css("position"))&&(l="relative"),i=t(a.wrapper).css(t.extend({},s.wrapper,e(r,n),{position:l})),this.textareaTop=parseInt(r.css("border-top-width")),this.$el=t(a.overlay).css(t.extend({},s.overlay,e(r,o),{top:this.textareaTop,right:parseInt(r.css("border-right-width")),bottom:parseInt(r.css("border-bottom-width")),left:parseInt(r.css("border-left-width"))})),this.$textarea=r.css(s.textarea),this.$textarea.wrap(i).before(this.$el),this.$textarea.origVal=r.val,this.$textarea.val=t.proxy(this.val,this),this.$textarea.on({"input.overlay":t.proxy(this.onInput,this),"change.overlay":t.proxy(this.onInput,this),"scroll.overlay":t.proxy(this.resizeOverlay,this),"resize.overlay":t.proxy(this.resizeOverlay,this)}),this.strategies=[]}var a,s,n,o;return a={wrapper:'<div class="textoverlay-wrapper"></div>',overlay:'<div class="textoverlay"></div>'},s={wrapper:{margin:0,padding:0,overflow:"hidden"},overlay:{position:"absolute",color:"transparent","white-space":"pre-wrap","word-wrap":"break-word",overflow:"hidden"},textarea:{background:"transparent",position:"relative",outline:0}},n=["display"],o=["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left","font-family","font-weight","font-size","background-color"],t.extend(r.prototype,{val:function(t){return null==t?this.$textarea.origVal():this.setVal(t)},setVal:function(t){return this.$textarea.origVal(t),this.renderTextOnOverlay(),this.$textarea},onInput:function(t){this.renderTextOnOverlay()},renderTextOnOverlay:function(){var e,r,a,s,n,o;for(e=t("<div></div>").text(this.$textarea.val()),r=0,a=this.strategies.length;a>r;r++)s=this.strategies[r],n=s.match,t.isArray(n)&&(n=t.map(n,function(t){return t.replace(/(\(|\)|\|)/g,"$1")}),n=new RegExp("("+n.join("|")+")","g")),o=Object.keys(s.css).map(function(t){return t+": "+s.css[t]}).join(";"),e.contents().each(function(){var e,r,a,s;if(this.nodeType==Node.TEXT_NODE){for(e=this.textContent,r="",s=n.lastIndex=0;;s=n.lastIndex){if(!(a=n.exec(e))){s&&(r+=i(e.substr(s)));break}a=a[0],r+=i(e.substr(s,n.lastIndex-s-a.length)),r+='<span style="'+o+'">'+i(a)+"</span>"}s&&t(this).replaceWith(r)}});return this.$el.html(e.contents()),this},resizeOverlay:function(){this.$el.css({top:this.textareaTop-this.$textarea.scrollTop()})},register:function(e){return e=t.isArray(e)?e:[e],this.strategies=this.strategies.concat(e),this.renderTextOnOverlay()},destroy:function(){this.$textarea.off(".overlay"),this.$textarea.parent().after(this.$textarea).remove(),this.$textarea.removeData("overlay"),this.$textarea=null}}),r}();t.fn.overlay=function(e){var r;return r="overlay","destroy"===e?this.each(function(){var e=t(this).data(r);e&&e.destroy()}):this.each(function(){var a,i;(i=(a=t(this)).data(r))||(i=new s(a),a.data(r,i)),i.register(e)})}}(window.jQuery);